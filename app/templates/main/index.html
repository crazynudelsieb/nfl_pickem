{% extends "base.html" %}

{% block title %}Home - NFL Pick'em{% endblock %}

{% block content %}
<div class="landing-page">
    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="hero-content">
                <div class="hero-badge">
                    üèà NFL 2025 Season
                </div>
                <h1 class="hero-title">
                    Smart NFL Picks.<br>
                    <span class="hero-accent">Better Competition.</span>
                </h1>
                <p class="hero-subtitle">
                    Strategic pick'em game with unique rules: one pick per game week, 
                    no repeat teams, smart scoring system with tiebreakers.
                </p>
                
                {% if not current_user.is_authenticated %}
                <div class="hero-actions">
                    <a href="{{ url_for('auth.register') }}" class="btn-hero-primary">
                        Start Playing Free
                    </a>
                    <a href="{{ url_for('auth.login') }}" class="btn-hero-secondary">
                        Sign In
                    </a>
                </div>
                
                <div class="hero-stats">
                    <div class="stat-item">
                        <div class="stat-number">18</div>
                        <div class="stat-label">Game Weeks</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">32</div>
                        <div class="stat-label">NFL Teams</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">4</div>
                        <div class="stat-label">Playoff Spots</div>
                    </div>
                </div>
                {% else %}
                <div class="hero-actions">
                    <a href="{{ url_for('main.current_picks') }}" class="btn-hero-primary">
                        Make Your Picks
                    </a>
                    <a href="{{ url_for('main.leaderboard') }}" class="btn-hero-secondary">
                        View Leaderboard
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </section>

    {% if current_user.is_authenticated %}
    <!-- User Dashboard -->
    <section class="dashboard">
        <div class="container">
            <!-- Quick Stats -->
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-icon">üéØ</div>
                    <div class="stat-content">
                        <div class="stat-number">{{ stats.wins or 0 }}</div>
                        <div class="stat-label">Wins This Season</div>
                        {% if stats.accuracy %}
                        <div class="stat-detail">{{ "%.1f"|format(stats.accuracy) }}% accuracy</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-content">
                        <div class="stat-number">{{ stats.tiebreaker_points or 0 }}</div>
                        <div class="stat-label">Tiebreaker Points</div>
                        <div class="stat-detail">Point differential total</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üî•</div>
                    <div class="stat-content">
                        <div class="stat-number">{{ stats.current_streak or 0 }}</div>
                        <div class="stat-label">
                            {% if stats.current_streak > 0 %}
                            Winning Streak
                            {% elif stats.current_streak < 0 %}
                            Losing Streak
                            {% else %}
                            No Streak
                            {% endif %}
                        </div>
                        <div class="stat-detail">Current performance</div>
                    </div>
                </div>
            </div>

            <!-- Current Week Games Preview -->
            {% if current_week_games %}
            <div class="dashboard-section">
                <div class="section-header">
                    <h2>Game Week {{ current_week }}</h2>
                    <a href="{{ url_for('main.current_picks') }}" class="btn-primary">
                        Make Your Pick
                    </a>
                </div>
                
                <div class="games-preview">
                    {% for game in current_week_games[:4] %}
                    <div class="game-preview">
                        <div class="teams">
                            <span class="team">{{ game.away_team.abbreviation }}</span>
                            <span class="vs">@</span>
                            <span class="team">{{ game.home_team.abbreviation }}</span>
                        </div>
                        <div class="game-info">
                            {% if game.is_final %}
                            <span class="score">{{ game.away_score }} : {{ game.home_score }}</span>
                            <span class="status final">Final</span>
                            {% elif game.status == 'in_progress' %}
                            <span class="score">{{ game.away_score or 0 }} : {{ game.home_score or 0 }}</span>
                            <span class="status live">Live</span>
                            {% else %}
                            <span class="time">{{ game.game_time.strftime('%a %I:%M %p') }}</span>
                            <span class="status upcoming">Upcoming</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                {% if current_week_games|length > 4 %}
                <div class="view-more">
                    <a href="{{ url_for('main.current_picks') }}">
                        View all {{ current_week_games|length }} games ‚Üí
                    </a>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Your Groups -->
            {% if user_groups %}
            <div class="dashboard-section">
                <div class="section-header">
                    <h2>Your Groups</h2>
                    <a href="{{ url_for('groups.create') }}" class="btn-secondary">
                        Create Group
                    </a>
                </div>
                
                <div class="groups-grid">
                    {% for group in user_groups[:3] %}
                    <div class="group-card">
                        <div class="group-header">
                            <h3>{{ group.name }}</h3>
                            {% if group.is_private %}
                            <span class="badge private">Private</span>
                            {% else %}
                            <span class="badge public">Public</span>
                            {% endif %}
                        </div>
                        
                        {% if group.description %}
                        <p class="group-description">
                            {{ group.description[:80] }}{% if group.description|length > 80 %}...{% endif %}
                        </p>
                        {% endif %}
                        
                        <div class="group-footer">
                            <span class="member-count">{{ group.get_member_count() }} members</span>
                            <a href="{{ url_for('groups.index', group=group.slug) }}" class="group-link">
                                View ‚Üí
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                {% if user_groups|length > 3 %}
                <div class="view-more">
                    <a href="{{ url_for('groups.index') }}">
                        View all {{ user_groups|length }} groups ‚Üí
                    </a>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </section>
    {% endif %}

</div>
{% endblock %}

{% block scripts %}
{% if current_week_games %}
{% set has_live_games = current_week_games | selectattr('status', 'equalto', 'in_progress') | list | length > 0 %}
{% if has_live_games %}
<script>
    // Auto-refresh game scores every 30 seconds if there are live games
    setInterval(function() {
        // Refresh the page to get updated scores
        window.location.reload();
    }, 30000); // 30 seconds
</script>
{% endif %}
{% endif %}
{% endblock %}
