{% extends "base.html" %}

{% block title %}Profile - NFL Pick'em{% endblock %}

{% block content %}
<div class="container">
    <div style="margin-bottom: 2rem;">
        <h1 style="font-size: 1.875rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.5rem;">
            Profile
        </h1>
        <p style="color: var(--text-secondary);">
            Manage your account information and preferences
        </p>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
        <!-- Profile Card -->
        <div class="leaderboard-card">
            <div class="leaderboard-header">
                <h2 style="margin: 0; font-size: 1.125rem; color: var(--text-primary);">üë§ Your Profile</h2>
            </div>
            <div style="padding: 2rem;">
                <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 2rem;">
                    <div style="width: 5rem; height: 5rem; border-radius: 50%; background: var(--accent-blue); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 2rem; margin-bottom: 1rem; overflow: hidden;">
                        {% if user.avatar_url %}
                        <img src="{{ user.avatar_url }}" alt="{{ user.username }}" style="width: 100%; height: 100%; object-fit: cover;">
                        {% else %}
                        {{ user.username[0]|upper }}
                        {% endif %}
                    </div>
                    <h2 style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary); margin: 0;">
                        {{ user.display_name or user.username }}
                    </h2>
                    <p style="color: var(--text-secondary); margin: 0.25rem 0 0 0;">@{{ user.username }}</p>
                    <p style="color: var(--text-muted); font-size: 0.875rem; margin: 0.25rem 0 0 0;">{{ user.email }}</p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 2rem; padding: 1.5rem; background: var(--bg-tertiary); border-radius: 8px;">
                    <div style="text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-green); margin-bottom: 0.25rem;">
                            {{ all_time_stats.wins if all_time_stats else 0 }}
                        </div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em;">
                            Career Wins
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-red); margin-bottom: 0.25rem;">
                            {{ all_time_stats.losses if all_time_stats else 0 }}
                        </div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em;">
                            Career Losses
                        </div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: {% if all_time_stats and all_time_stats.accuracy >= 60 %}var(--accent-green){% elif all_time_stats and all_time_stats.accuracy >= 40 %}var(--warning-color){% else %}var(--accent-red){% endif %}; margin-bottom: 0.25rem;">
                            {% if all_time_stats %}
                                {{ "%.1f"|format(all_time_stats.accuracy) }}%
                            {% else %}
                                0%
                            {% endif %}
                        </div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em;">
                            Overall Accuracy
                        </div>
                    </div>
                </div>

                <!-- Awards/Badges Section -->
                {% if user_awards %}
                <div style="padding: 1.5rem; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 1.5rem;">
                    <h3 style="margin: 0 0 1rem 0; font-size: 0.875rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em;">
                        üèÜ Achievements
                    </h3>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; align-items: center;">
                        {% if global_championships > 0 %}
                        <span style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.5rem 0.75rem; background: linear-gradient(135deg, #FFD700, #FFA500); color: #1a1a1a; border-radius: 20px; font-weight: 600; font-size: 0.75rem;">
                            üëë {{ global_championships }}x Global Champion
                        </span>
                        {% endif %}
                        {% if group_championships > 0 %}
                        <span style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.5rem 0.75rem; background: var(--accent-blue); color: white; border-radius: 20px; font-weight: 600; font-size: 0.75rem;">
                            üèÜ {{ group_championships }}x Group Champion
                        </span>
                        {% endif %}
                        <a href="{{ url_for('main.hall_of_fame') }}" style="padding: 0.5rem 0.75rem; background: var(--bg-secondary); color: var(--text-primary); border-radius: 20px; font-size: 0.75rem; text-decoration: none; display: inline-flex; align-items: center; gap: 0.25rem;">
                            View All Awards ‚Üí
                        </a>
                    </div>
                </div>
                {% endif %}

                <div style="display: flex; gap: 0.75rem;">
                    <a href="{{ url_for('auth.edit_profile') }}" style="flex: 1; padding: 0.75rem; background: var(--accent-blue); color: white !important; border-radius: 6px; font-weight: 600; text-decoration: none; text-align: center; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        ‚úèÔ∏è Edit Profile
                    </a>
                    <a href="{{ url_for('auth.change_password') }}" style="flex: 1; padding: 0.75rem; background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 6px; font-weight: 600; text-decoration: none; text-align: center; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;">
                        üîí Change Password
                    </a>
                </div>
            </div>
        </div>

        <!-- Account Details -->
        <div class="leaderboard-card">
            <div class="leaderboard-header">
                <h2 style="margin: 0; font-size: 1.125rem; color: var(--text-primary);">üìä All-Time Statistics</h2>
            </div>
            <div style="padding: 2rem;">
                {% if all_time_stats %}
                <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div style="padding: 1rem; background: var(--bg-tertiary); border-radius: 6px;">
                            <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; font-weight: 600;">
                                Total Picks Made
                            </div>
                            <div style="font-size: 1.75rem; font-weight: 700; color: var(--text-primary);">
                                {{ all_time_stats.total_picks }}
                            </div>
                        </div>
                        <div style="padding: 1rem; background: var(--bg-tertiary); border-radius: 6px;">
                            <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; font-weight: 600;">
                                Groups Joined
                            </div>
                            <div style="font-size: 1.75rem; font-weight: 700; color: var(--text-primary);">
                                {{ user.get_groups()|length }}
                            </div>
                        </div>
                    </div>
                    
                    <div style="padding: 1.5rem; background: var(--bg-tertiary); border-radius: 8px;">
                        <h3 style="margin: 0 0 1rem 0; font-size: 0.875rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em;">
                            Win/Loss Record
                        </h3>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                            <span style="color: var(--text-primary); font-weight: 600;">Wins</span>
                            <span style="color: var(--accent-green); font-weight: 700; font-size: 1.125rem;">{{ all_time_stats.wins }}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                            <span style="color: var(--text-primary); font-weight: 600;">Losses</span>
                            <span style="color: var(--accent-red); font-weight: 700; font-size: 1.125rem;">{{ all_time_stats.losses }}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                            <span style="color: var(--text-primary); font-weight: 600;">Missed Games</span>
                            <span style="color: var(--warning-color); font-weight: 700; font-size: 1.125rem;">{{ all_time_stats.missed_games }}</span>
                        </div>
                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: var(--text-primary); font-weight: 600;">Total Accuracy</span>
                            <span style="color: {% if all_time_stats.accuracy >= 60 %}var(--accent-green){% elif all_time_stats.accuracy >= 40 %}var(--warning-color){% else %}var(--accent-red){% endif %}; font-weight: 700; font-size: 1.25rem;">
                                {{ "%.1f"|format(all_time_stats.accuracy) }}%
                            </span>
                        </div>
                    </div>
                    
                    <div style="padding: 1.5rem; background: var(--bg-tertiary); border-radius: 8px;">
                        <h3 style="margin: 0 0 1rem 0; font-size: 0.875rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em;">
                            Tiebreaker Points
                        </h3>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: {% if all_time_stats.tiebreaker_points >= 0 %}var(--accent-green){% else %}var(--accent-red){% endif %};">
                                {% if all_time_stats.tiebreaker_points > 0 %}+{% endif %}{{ all_time_stats.tiebreaker_points }}
                            </div>
                            <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">
                                Career Total
                            </div>
                        </div>
                    </div>
                    
                    <div style="padding: 1.5rem; background: var(--bg-tertiary); border-radius: 8px;">
                        <h3 style="margin: 0 0 1rem 0; font-size: 0.875rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em;">
                            Longest Streak
                        </h3>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: 700; color: {% if all_time_stats.longest_streak > 0 %}var(--accent-green){% elif all_time_stats.longest_streak < 0 %}var(--accent-red){% else %}var(--text-muted){% endif %};">
                                {% if all_time_stats.longest_streak > 0 %}+{% endif %}{{ all_time_stats.longest_streak }}{% if all_time_stats.longest_streak > 0 %}W{% elif all_time_stats.longest_streak < 0 %}L{% endif %}
                            </div>
                            <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">
                                Career Best
                            </div>
                        </div>
                    </div>
                </div>
                {% else %}
                <p style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                    No statistics available yet. Start making picks to see your stats!
                </p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Current Season Stats -->
    {% if season_stats and season_stats.total %}
    <div class="leaderboard-card" style="margin-bottom: 2rem;">
        <div class="leaderboard-header">
            <h2 style="margin: 0; font-size: 1.125rem; color: var(--text-primary);">üèà Current Season ({{ current_season.year if current_season else 'N/A' }})</h2>
        </div>
        <div style="padding: 2rem;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                <div style="text-align: center; padding: 1rem; background: var(--bg-tertiary); border-radius: 6px;">
                    <div style="font-size: 1.75rem; font-weight: 700; color: var(--accent-green); margin-bottom: 0.25rem;">
                        {{ season_stats.total.wins }}
                    </div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase;">
                        Wins
                    </div>
                </div>
                <div style="text-align: center; padding: 1rem; background: var(--bg-tertiary); border-radius: 6px;">
                    <div style="font-size: 1.75rem; font-weight: 700; color: var(--accent-red); margin-bottom: 0.25rem;">
                        {{ season_stats.total.losses }}
                    </div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase;">
                        Losses
                    </div>
                </div>
                <div style="text-align: center; padding: 1rem; background: var(--bg-tertiary); border-radius: 6px;">
                    <div style="font-size: 1.75rem; font-weight: 700; color: var(--warning-color); margin-bottom: 0.25rem;">
                        {{ season_stats.total.missed_games }}
                    </div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase;">
                        Missed
                    </div>
                </div>
                <div style="text-align: center; padding: 1rem; background: var(--bg-tertiary); border-radius: 6px;">
                    <div style="font-size: 1.75rem; font-weight: 700; color: {% if season_stats.total.accuracy >= 60 %}var(--accent-green){% elif season_stats.total.accuracy >= 40 %}var(--warning-color){% else %}var(--accent-red){% endif %}; margin-bottom: 0.25rem;">
                        {{ "%.1f"|format(season_stats.total.accuracy) }}%
                    </div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase;">
                        Accuracy
                    </div>
                </div>
                <div style="text-align: center; padding: 1rem; background: var(--bg-tertiary); border-radius: 6px;">
                    <div style="font-size: 1.75rem; font-weight: 700; color: {% if season_stats.total.tiebreaker_points >= 0 %}var(--accent-green){% else %}var(--accent-red){% endif %}; margin-bottom: 0.25rem;">
                        {% if season_stats.total.tiebreaker_points > 0 %}+{% endif %}{{ season_stats.total.tiebreaker_points }}
                    </div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase;">
                        Tiebreaker
                    </div>
                </div>
                <div style="text-align: center; padding: 1rem; background: var(--bg-tertiary); border-radius: 6px;">
                    <div style="font-size: 1.75rem; font-weight: 700; color: {% if season_stats.total.longest_streak > 0 %}var(--accent-green){% elif season_stats.total.longest_streak < 0 %}var(--accent-red){% else %}var(--text-muted){% endif %}; margin-bottom: 0.25rem;">
                        {% if season_stats.total.longest_streak > 0 %}+{% endif %}{{ season_stats.total.longest_streak }}
                    </div>
                    <div style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase;">
                        Longest Streak
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Account Info Card -->
    <div class="leaderboard-card" style="margin-bottom: 2rem;">
        <div class="leaderboard-header">
            <h2 style="margin: 0; font-size: 1.125rem; color: var(--text-primary);">üìã Account Information</h2>
        </div>
        <div style="padding: 2rem;">
            <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                    <div>
                        <label style="display: block; font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; font-weight: 600;">
                            Username
                        </label>
                        <span style="font-size: 1rem; color: var(--text-primary); font-weight: 500;">
                            {{ user.username }}
                        </span>
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; font-weight: 600;">
                            Email
                        </label>
                        <span style="font-size: 1rem; color: var(--text-primary); font-weight: 500;">
                            {{ user.email }}
                        </span>
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; font-weight: 600;">
                            Display Name
                        </label>
                        <span style="font-size: 1rem; color: var(--text-primary); font-weight: 500;">
                            {{ user.display_name or 'Not set' }}
                        </span>
                    </div>
                    <div>
                        <label style="display: block; font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; font-weight: 600;">
                            Member Since
                        </label>
                        <span style="font-size: 1rem; color: var(--text-primary); font-weight: 500;">
                            {{ user.created_at.strftime('%B %d, %Y') if user.created_at else 'Unknown' }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
@media (max-width: 768px) {
    div[style*="grid-template-columns: 1fr 1fr"] {
        grid-template-columns: 1fr !important;
    }
}
</style>
{% endblock %}
